### 3.1 메시지의 흐름

- **HTTP 메시지** : HTTP 애플리케이션 간에 주고받는 데이터 블록
- **메시지 방향**
    - 인바운드 : 트랜잭션 방향을 표현하는 용어로, 서버 방향을 가리킴
    - 아웃바운드 : 트랜잭션 방향을 표현하는 용어로, 클라이언트 방향을 가리킴
    - 업스트림 : 메시지의 발송자는 수신자의 업스트림
    - 다운스트림 : 모든 HTTP 메시지는 요청/응답 메시지에 상관없이 다운스트림으로 흐름
    
    <img width="525" height="641" alt="image" src="https://github.com/user-attachments/assets/d252277c-ca10-41ef-aad4-388cf5383dc9" />

---

### 3.2 메시지의 각 부분

- **메시지 구성**
    - **시작줄**
        - 메시지 종류
        - 아스키 문자열
        - 두 글자의 줄바꿈 문자열(`\r\n` (CRLF))로 끝남.
        - 요청 메시지의 시작줄 : **무엇**을 해야하는지
        - 응답 메시지의 시작줄 : **무슨 일**이 일어났는지
    - **헤더**
        - 속성
        - 아스키 문자열
        - 두 글자의 줄바꿈 문자열(`\r\n`(CRLF))로 끝남.
    - **본문(선택)**
        - 데이터(텍스트나 이진 데이터 포함 가능)
- 요청과 응답 메시지를 포함한 HTTP 트랜잭션
    - **요청 메시지 형식**
        
        ```python
        <메서드> <요청 URL> <버전>
        <헤더>
        
        <엔터티 본문>
        ```
        
    - **응답 메시지 형식**
        
        ```python
        <버전> <상태 코드> <사유 구절>
        <헤더>
        
        <엔터티 본문>
        ```
        
    - **메서드**
        - 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작
        
        | 메서드 | 설명 | 메시지 본문 유무 |
        | --- | --- | --- |
        | `GET` | 서버에서 어떤 문서를 가져옴. | X |
        | `HEAD` | 서버에서 어떤 문서에 대한 헤더만 가져옴 | X |
        | `POST` | 서버가 처리해야 할 데이터를 보냄. | O |
        | `PUT` | 서버에 요청 메시지의 본문을 저장 | O |
        | `TRACE` | 메시지가 프락시를 거쳐 서버에 도달하는 과정을 추적 | X |
        | `OPTIONS` | 서버가 어떤 메서드를 수행할 수 있는지 확인 | X |
        | `DELETE` | 서버에서 문서를 제거 | X |
        - HTTP는 쉽게 확장할 수 있도록 설계되었기 때문에, 다른 서버는 그들만의 메서드를 추가로 구현 가능(= 확장 메서드)
    - **요청 URL**
        - 요청 대상이 되는 리소스를 지칭하는 URL
    - **버전**
        - 메시지에서 사용 중인 HTTP 버전
        - 형식 : `HTTP/<메이저>.<마이너>`
    - **상태 코드**
        - 요청 중에 무엇이 일어났는지 설명하는 세 자리 숫자
    - **사유 구절**
        - 상태 코드에 대한 설명 문구
        - 상태 코드 이후부터 줄바꿈 문자열까지가 사유 구절에 해당
        - 오직 사람에게 읽히기 위한 목적으로만 존재
    - **헤더**
        - 이름, 콜론(`:`), 선택적인 공백, 값, CRLF가 순서대로 나타나는 **0개 이상**의 헤더들
        - `이름/값` 쌍의 목록으로 요청/응답 메시지에 추가 정보를 더하는 역할
        - `HTTP/1.1`과 같은 몇몇 버전의 HTTP는 요청이나 응답에 어떤 특정 헤더가 포함돼야만 유효한 것으로 간주
        - 헤더나 엔터티 본문이 없어도 HTTP 헤더의 집합은 항상 빈 줄(그냥 CRLF)로 끝나야 함
            - Q. 이 규칙을 지키지 않는 구현체와의 호환을 위해 마지막 CRLF 없이 끝나는 메시지도 받아들일 수 있어야한다는게 무슨 소리인가? (P.54)
        - **헤더 분류**
            - 일반 헤더
            - 요청 헤더
            - 응답 헤더
            - Entity 헤더
            - 확장 헤더
        - 헤더는 여러 줄로 나눌 수 있음. (단, 이 경우 추가된 줄 앞에 최소 하나의 스페이스 혹은 탭 문자가 와야 함.)
            - `Server: Test Server Version 1.0`을 여러 줄로 나누어 작성한 예시
            
            ```python
            ...
            Server: Test Server
            	Version 1.0
            ```
            
    - **엔터티 본문**
        - 임의의 데이터 블록
    - **상태 코드**
        - 클라이언트에게 무엇이 일어났는지 말해주는 설명
        - `2XX` : 성공
        - `3XX` : 리소스가 옮겨짐
        - `4XX` : 클라이언트에서 에러남
        - `5XX` : 서버에서 에러남
    - **버전 번호**
        - `HTTP/x.y`형식으로 요청과 응답 메시지 양쪽 모두에 기술됨.
        - HTTP로 대화하는 애플리케이션들에게 대화 상대의 능력과 메시지의 형식에 대한 단서를 제공해주기 위함
        - **HTTP/1.1로 응답을 받았을 때 올바른 해석**
            - 응답을 보낸 메시지는 HTTP/1.1 메시지다 (**X**)
            - 응답을 보낸 애플리케이션이 HTTP/1.1까지 이해할 수 있다.(**O**)
        - 버전 번호는 무조건 정수이고, 각 숫자는 분리된 숫자로 다루어짐
            - ex) HTTP/`2.22`는 HTTP/`2.3`보다 큼. (Why? → 22 > 3)
- **HTTP/0.9 버전**
    - 요청은 메서드와 요청 URL로만 이루어짐.
        - 버전 정보 X, 헤더 X
    - 응답은 엔터티로만 이루어짐.
        - 상태 코드 X, 사유 구절 X, 헤더 X
    
---

### 3.3 메서드

- 모든 서버가 모든 메서드를 구현하지 않음.
- **안전한 메서드**
    - HTTP 요청의 결과로 서버에 어떤 일도 일어나지 않는 메서드 (`GET`, `HEAD`)
- `GET`
    - 서버에게 리소스 요청
- `HEAD`
    - 클라이언트가 리소스를 실제로 가져올 필요 없이, 헤더만을 조사할 수 있도록 해줌.
    - `HTTP/1.1` 준수를 위해서는 `HEAD` 메서드가 반드시 구현되어 있어야 함.
- `PUT`
    - 서버가 요청의 본문을 가지고 요청 URL의 이름대로 새 문서를 만들거나, 이미 URL이 존재한다면 본문을 사용해서 교체하는 것
- `POST`
    - 입력된 데이터를 서버에 전송
    - 주로 HTML 폼 데이터를 서버로 전달할 때 사용
- `TRACE`
    - 요청이 방화벽, 프락시, 게이트웨이 등의 애플리케이션을 통과하며 수정될 수 있기 때문에, 클라이언트에게 자신의 요청이 서버에 도달했을 때 어떻게 보이게 되는지 알려줌
    - 요청 전송의 마지막 단게에 있는 서버는 자신이 받은 요청 메시지를 본문에 넣어 TRACE 응답을 되돌려줌(루프백)
    - 주로 진단을 위해 사용됨
        - 네트워크 경로 상의 메시지 변형을 추적하기 위해 중간 애플리케이션이 모든 요청을 동일하게, 특별한 변경 없이 처리한다는 가정을 하지만, 실제로는 중간 장비들이 TRACE 요청을 차단하거나 변형할 수 있기 때문에 가정이 성립하지 않아 TRACE의 진단 효과가 제한됨.
            - 대부분의 HTTP 애플리케이션은 메서드에 따라 다르게 동작함.
                - 프락시
                    - `POST` : 바로 서버로 통과
                    - `GET` : 다른 애플리케이션(ex. 웹 캐시)로 전송
    - 요청 메시지에는 어떤 엔터티 본문도 보낼 수 없음.
- `OPTIONS`
    - 서버에게 특정 리소스에 대해 어떤 메서드가 지원되는지 물어봄.
- `DELETE`
    - 서버에게 요청 URL로 지정한 리소스를 삭제할 것을 요청
    - 하지만, 삭제가 수행되는 것을 보장하지 못함.
        - Why? → HTTP 명세는 서버가 클라이언트에게 알리지 않고 요청을 무시하는 것을 허용하기 때문
- **확장 메서드**
    - `HTTP/1.1` 명세에 정의되지 않은 메서드
    - 확장 메서드의 대표적인 예
        - `LOCK`
            - 사용자가 리소스를 잠글 수 있도록 해줌.
            - ex) 문서를 편집하는 동안 다른 사람이 동시에 같은 문서를 편집하지 못하도록 문서를 잠금
        - `MKCOL`
            - 사용자가 문서를 생성할 수 있도록 해줌.
            - Q. POST랑 뭐가 다른건지?
        - `COPY`
            - 서버에 있는 리소스 복사
        - `MOVE`
            - 서버에 있는 리소스 이동
    
---

### 3.4 상태 코드

- `100` - `199` : 정보성 상태 코드
    - `HTTP/1.1`에서 도입됨.
- `200` - `299` : 성공 상태 코드
- `300` - `399` : 리다이렉션 상태 코드
    - 클라이언트가 관심있어 하는 리소스에 대해 다른 위치를 사용하라고 말해주거나 그 리소스의 내용 대신 다른 대안 응답을 제공
    - 리다이렉션 상태 코드 중 몇몇은 리소스에 대한 애플리케이션의 로컬 복사본이 원래 서버와 비교했을 때 유효한지 확인하기 위해 사용됨. (ex. `304` )
- `400` - `499` : 클라이언트 에러 상태 코드
- `500` - `599` : 서버 에러 상태 코드
    
---

### 3.5 헤더

- **일반 헤더**
    - 클라이언트와 서버 양쪽 모두 사용
    - ex) `Date: Tue, 3 Oct 1974 02:16:00 GMT` : 데이터가 만들어진 일시
- **요청 헤더**
    - 요청 메시지를 위한 헤더
    - 서버에게 클라이언트가 받고자 하는 데이터의 타입이 무엇인지와 같은 부가 정보를 제공
    - ex) `Accept: */*` : 요청에 대응하는 어떤 미디어 타입도 받아들이겠다
- **응답 헤더**
    - 클라이언트에게 정보를 제공하기 위한 헤더
    - ex) `Server: Tiki-Hut/1.0` : 클라이언트는 Tiki-Hut 서버 1.0 버전과 대화하고 있다
- **엔터티 헤더**
    - 엔터티 본문에 대한 헤더
    - 요청과 응답 메시지 모두에 나타날 수 있음
    - 웹 브라우저는 내용 유형을 기술한 Content-Type 헤더를 보고 그 객체를 어떻게 보여줄지 결정
    - ex) `Content-Type : text/html; charset=iso-latin-1` : 데이터가 `iso-latin-1` 문자집합으로 된 HTML 문서임을 알려줌
- **확장 헤더**
    - HTTP 명세에 추가되지 않은 비표준 헤더
    - HTTP 프로그램은 확장 헤더들에 대해 설령 그 의미를 모른다 할지라도 용인하고 전달해야 함.
