# 3장: HTTP 메시지

## HTTP 메시지
> HTTP 애플리케이션 간에 주고받는 데이터 블록

클라이언트, 서버, 프락시 사이에 움직인다.
움직이는 방향에 따라 '인바운드', '아웃바운드', '다운스트림', '업스트림'으로 구분된다.

|이름|설명|
| ----- | ------------------ |
| 인바운드 | 서버 방향으로 가는 메시지 | 
| 아웃바운드 | 클라이언트/에이전트로 가는 메시지 |
| 다운스트림 | 메시지의 목적지로 가는 지점들 | 
| 업스트림 | 메시지가 그전에 있었던 지점들 |

## 메시지 문법
요청과 응답의 문법은 시작줄을 제외하고 문법이 같다.

요청 메시지: 웹 서버에 특정 동작 요구  
응답 메시지: 요청의 결과를 클라이언트에게 돌려줌  

요청 메시지의 형식  
> <메서드> <요청 URL> <버전>  
> <헤더>  
>  
> <엔터티 본문>

응답 메시지의 형식
> <버전> <상태 코드> <사유 구절>  
> <헤더>  
>  
> <엔터티 본문>  



| 메시지 파트 | 내용 |
|---|---|
| 메서드 | 클라이언트가 리소스에게 요청하는 리소스 명령어 |  
| 요청 URL | 리소스를 지정하는 완전한 URL 혹은 URL의 경로 구성요소 |
| 버전 | 이 메시지에서 사용 중인 HTTP의 버전. 형식: HTTP/<메이저(정수)>.<마이너(정수)> |
| 상태 코드 | 요청 중에 무엇이 일어났는지 설명하는 세 자리의 숫자 |
| 사유 구절 | 상태 코드 이후부터 줄바꿈 문자열까지 상태 코드를 해석이 조금 쉽게 변향한 부분. 메시지 처리에 영향을 주지는 않는다. |
| 헤더들 | 이름, 콜론(:), 선택적인 공백 값, CRLF가 순서대로 나타나는 0개 이상의 헤더들. 이 헤더의 목록은 빈 줄(CRLF)로 끝나 헤더 목록의 끝과 엔터티 본문의 시작을 표시 |
| 엔터티 본문 | 임의의 데이터 블록을 포함. 모든 메시지가 갖는 것은 아님 |  

NOTE: 

> HTTP헤더의 집합은 항상 CRLF로 끝나야 함을 주의하여라. 그러나 개발을 할때, CRLF가 빠질수 있다는것을 고려하여 개발하라.

> 엔터티 본문, 헤더 등은 15장에서 더 자세히 나와있다.

## 시작줄 
> HTTP 메시지의 시작. 요청/응답으로 나뉘어짐

모든 필드는 공백으로 구분

> 요청: <메서드> <요청 URL> <HTTP 버전> 

> 응답: <HTTP 버전> <상태 코드> <사유 구절>



### 사유 구절
> 응답 시작줄의 마지막 구성요소. 상태코드를 보기 편하게 해석한 구절. 딱히 엄격한 규칙은 없음.

## 헤더
> HTTP 메시지에 추가 정보를 더한며, 시작줄 뒤에 0개 이상으로 온다.
> 기본적으로 이름/값 쌍의 목록이다.

문법: 이름, 쉼표, 공백(선택적), 필드 값, CRLF

ie.
Content-Type: text/plain
Content-Length: 19

NOTE:
헤더가 너무 길면 여러 줄로 분해 가능하다.
이는 추가하는 줄 앞에 스페이스나 탭 문자를 넣으면 된다.

## 메서드
> 모든 서버가 모든 메서드를 구현할수 없다. 버전과 사용 목적에 따라, 사용 가능한 메서드의 한계가 존재한다.

### 안전한 메서드(Safe Method)
> HTTP 요청의 결과로 서버에 일어나는 일이 없는 메서드 (Non-modifying methods)

실용상 *'안전한'* 메서드는 존재하지 않는다. 메서드가 서버에 무슨 영향을 끼치는것은 개발자에 따르기 때문이다.

그러나 '안전한 메서드' 라고 분류하는 이유는, 서버에 영향을 주는 메서드를 사용하였을때 사용자에게 이 사실을 알리기 위해서다.

### HTTP 메서드

|메서드|역할|본문 요구|
| ------- | ---------------------------- | - |
| GET | 서버에서 리소스 요청 | N |
| HEAD | 서버에서 리소스의 **헤더만** 요청 | N |
| | 리소스의 정보와 존재여부등만 때어올수 있다 | |
| PUT | 요청 메시지의 본문을 지정한 곳에 저장하라 **(생성 및 덮어씌우기)** | Y |
| POST | 서버가 처리해야 할 데이터를 보낸다 **(수정 및 업데이트)** | Y |
| TRACE | 메시지가 서버에 도착하였을때 어떻게 보이는지 알리는것. **(주로 진단에 사용)** | N |
| | 메서드를 구별하는 기능은 없음, 서버는 받은 메시지를 다시 보내기만 한다. | |
| OPTIONS | 특정 리소스에 대해, 어떤 메서드가 지원되는지 물어보는것 | N |
| DELETE | 서버에서 리소스를 제거 | N |

### 확장 메서드
> HTTP/1.1 명세에 정의되지 않은 메서드. 개발자가 자신의 서버의 리소스 관리 능력을 확장하기 위해 존재.

**대표적 예시**
|확장 메소드|역할|
| ----- | ------------------- |
| LOCK | 사용자가 리소스를 잠글 수 있게 함 | 
| MKCOL | 사용자가 문서를 생성할수 있게 해줌 |
| COPY | 서버에 있는 리소스를 복사한다 |
| MOVE | 서버에 있는 리소스를 옮긴다 |

CAUTION:
확장 메소드는 표준이 없기 때문에, 대부분 HTTP 애플리케이션이 이해하지 못한다.

프락시는 관용적으로 확정 메소드를 다운스트림 서버로 보내려고 시도하지만, 그렇지 못할때는 '501 Not Implemented' 상태 코드로 응답해야 한다.

그러므로 확장 메소드는 **'엄격하게 보내고, 관대하게 받는다'**라는 규칙을 따르는 것이 좋다.

## 상태 코드
>서버가 클라이언트에게 요청이 어떻게 처리되었는지 알려주는 코드

**대략적 역할**
|범위|정의된 범위|분류|
| ------- | ------- | -------- |
| 100~199 | 100~101 | 정보 |
| 200~299 | 200~206 | 성공 | 
| 300~399 | 300~305 | 리다이렉션 |
| 400~499 | 400~415 | 클라이언트 에러 |
| 500~599 | 500~505 | 서버 에러 |

> 만약에 정의된 범위 안에 없으면, 커스텀 상태 코드로 인식

**흔한 코드 예시**
|코드|사유 구절|의미|
| --- | ------------ | ---------------------- |
| 200 | OK | 성공 |
| 401 | Unauthorized | 사용자 이름과 비밀번호 필요 |
| 404 | Not Found | 요청한 URL에 해당하는 리소스를 못찾음 |


### 정보성 상태 코드 (논란)
> HTTP/1.1에 도입 되었으며, 요청 처리 진행 상황에 주로 쓴다

**예시**
|상태 코드|사유 구절|의미|
| --- | ---------- | -- |
| 100 | Continue | 클라이언트가 서버로 보낸 요청에 문제가 없으니 다음 요청을 이어서 보내도 된다는 것을 의미. 만약 클라이언트의 작업이 완료되었다면 이 응답은 무시. |
| 101 | Switching Protocols | 클라이언트가 **Upgrade** 헤더에 나열한 프로토콜 중 하나로 바뀌었음을 의미. |

NOTE:
상태 코드 100은 사용이 애매한 관계로, 논란이 많다. 가급적 안쓰는걸 추천.

## 헤더

### 헤더 분류

|헤더 분류|특징|
| --------- | --------------------------- |
| 일반 | 서버와 클라이언트 양쪽에 모두 나타날 수 있음 |
| | 어딘가에 메시지를 보내는 다른 애플리케이견들을 위해 다양한 목적으로 사용 |
| 요청 | 클라이언트가 받고자 하는 데이터 타입과 같은 부가 정보를 제공 |
| 응답 | 응답에 대한 부가 정보를 제공 |
| | 예) Server: Tiki-Hut/1.0 |
| Entity 헤더 | 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술 |
| | 예) Content-Type: text/html; charset=iso-latin-1 |
| 확장 헤더 | 명세에 정의되지 않은 새로운 헤더 |



Outside resources: 
https://developer.mozilla.org/ko/docs/Web/HTTP/Guides/Messages
https://developer.mozilla.org/ko/docs/Web/HTTP/Reference/Status
 
