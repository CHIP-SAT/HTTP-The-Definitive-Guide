### 통합점: 게이트웨이, 터널, 릴레이

HTTP는 웹에 있는 모든 리소스에 대한 프로토콜이자, 애플리케이션 간에 서로 다른 프로토콜을 상호 운용하는 용도로 사용하기도 한다.

따라서 **HTTP 위에 다른 프로토콜**을 얹으려고 하는 개발자들에게는 HTTP가 기본 구성요소가 된다.

이번 장에서 다루는 내용은 다음과 같다.
- `게이트웨이`: **서로 다른 프로토콜과 애플리케이션 간**의 HTTP 인터페이스
- `애플리케이션 인터페이스`: **서로 다른 형식의 웹 애플리케이션이 통신**하는 데 사용
- `터널`: HTTP 커넥션을 통해서 HTTP가 아닌 트래픽 전송
- `릴레이`: HTTP 프락시로, 한 번에 한 개의 홉에 데이터 전달

##

### 게이트웨이
웹에 더 복잡한 리소스를 올려야 할 필요가 생기면서, 모든 리소스를 한 개의 애플리케이션으로만 처리할 수 없어졌다.

그래서 리소스를 받기 위한 경로 안내 역할을 하는 게이트웨이를 고안했고, 이 게이트웨이의 역할은 리소스와 애플리케이션을 연결하는데에 초점을 둔다.

게이트웨이는 요청을 받고, 응답을 보내는 "포탈" 같이 동작하는데, 동적인 콘텐츠를 생성하거나 DB에 질의를 보낼 수 있다.

<br>

게이트웨이는 HTTP 트래픽을 다른 프로토콜로 자동 변환하여, 클라이언트가 다른 프로토콜을 알 필요 없이 서버 접속이 가능하게 한다.

따라서 한쪽에서는 HTTP로 통신하고, 다른 한쪽에서는 HTTP가 아닌 다른 포로토콜로 통신하고, 클라이언트 측과 서버 측 프로토콜을 빗금(/)으로 구분한다. `<클라이언트 프로토콜>/<서버 프로토콜>`과 같이 말이다.

![2025  8  22  19:27 Microsoft Lens](https://github.com/user-attachments/assets/9d9d17ea-2ead-44ab-a3b5-7b2620d66757)

- `서버 측 게이트웨이`: 위 사진처럼 서버쪽이 HTTP가 아니라 외래 프로토콜인 경우이다.
- `클라이언트 측 게이트웨이`: 클라이언트 쪽이 HTTP가 아니라 외래 프로토콜인 경우이다.

##

### 프로토콜 게이트웨이
브라우저는 특정 프로토콜에 게이트웨이 설정이 가능하다.

일반 HTTP 트래픽은 원 서버로 바로 보내고, FTP URL을 포함하면 HTTP/FTP 게이트웨이로 요청을 변환하여 처리하는 것이 가능하다.

- `HTTP/*: 서버 측 웹 게이트웨이`: 클라이언트로부터 HTTP 요청이 들어오면 해당 요청을 외래 프로토콜로 전환한다. HTTP/FTP 게이트웨이라면 HTTP 요청을 FTP 형식으로 변환하고 서버에 보낼 것이다.
- `HTTP/HTTPS: 서버 측 보안 게이트웨이`: 기업 내부의 모든 웹 요청을 암호화하여 원 서버에 보안을 증가시킨다.
- `HTTPS/HTTP: 클라이언트 측 보안 가속 게이트웨이`: HTTPS 트래픽을 받아 복호화하고, 웹 서버에 보낼 때는 일반 HTTP 요청을 한다. 원 서버가 복호화하는 비용을 아낄 수 있으나, 게이트웨이<-> 서버 네트워크 안전을 고려해야 한다.

##

### 리소스 게이트웨이
게이트웨이의 가장 일반적인 형태는 애플리케이션 서버이다.

애플리케이션 서버는 목적지 서버와 게이트웨이를 한 개의 서버로 결합하고, HTTP를 통해 클라이언트와 통신하고 서버 측에 있는 애플리케이션 프로그램에 연결하는 서버 측 게이트웨이이다.

API를 통해 요청을 서버에서 동작하고 있는 애플리케이션에 전달한다.

![2025  8  22  20:09 Microsoft Lens](https://github.com/user-attachments/assets/5a1cee96-9dc1-43bb-a707-dc6cfc132193)

우리가 잘 알고 있는 클라이언트-서버 아키텍처 동작이듯, API를 통해 애플리케이션 서버에 요청한다.

##

### 애플리케이션 인터페이스와 웹 서비스
애플리케이션을 연결할 때 까다로운 이유는 **데이터를 교환하려는 두 애플리케이션 사이에서 프로토콜 인터페이스를 맞추는 일**이다.

애플리케이션이 상호 운용을 하다보면 HTTP 헤더 만으로는 부족할 수 있다. 확장이나, 다른 프로토콜을 덧씌워 보완할 수 있긴 한데 뒷장에서 다룬다.

웹 서비스는 JSON, 혹은 초기에 XML을 사용하여 정보를 교환하는데 이들은 데이터 객체를 담는 데이터를 생성하고 해석하는 방식을 제공한다.

##

### 터널
HTTP의 또 다른 사용 방식인 웹 터널, 이는 HTTP 프로토콜을 지원하지 않는 애플리케이션에 HTTP을 사용해 접근하는 방법을 제공한다.

웹 터널을 사용하면 **HTTP 커넥션을 통해서 HTTP가 아닌 트래픽을 전송**할 수 있고, 다른 프로토콜을 HTTP 위에 올릴 수 있다. 즉, 이걸 사용하는 이유는 HTTP 커넥션 안에 HTTP가 아닌 다른 트래픽을 얹기 위해서이다.

#### CONNECT로 HTTP 터널 커넥션 맺기
웹 터널은 HTTP의 CONNECT 메소드를 사용해 커넥션을 맺는다. CONNECT 메소드는 터널 게이트웨이가 임의 목적 서버와 포트에 TCP 커넥션을 맺고 클라이언트<->서버 간에 오는 데이터를 무조건 전달하기를 요청한다.

![2025  8  22  20:44 Microsoft Lens](https://github.com/user-attachments/assets/b67858db-56ef-47e5-9868-e834cac43918)

위 사진은 SSL 터널 연결을 위해 CONNECT 사용하는 예이다. 똑같이 요청/응답 형식이 있고, 이는 239P 참고

<br>

#### SSL 터널링
웹 터널은 원래 방화벽을 통해 암호화된 SSL 트래픽을 전달하려고 개발되었다.

많은 회사가 보안을 위해 모든 트래픽이 패킷을 필터링 하는 라우터와 프록시를 지나도록 했다. 그러나, SSL 같이 암호화된 프로토콜은 낡은 프락시에서 처리가 되지 않는다.

터널을 사용해 SSL 트래픽을 HTTP 커넥션으로 전송해 80 포트만 허용하는 방화벽을 이용했다. 이러면 SSL 트래픽이 기존 프락시 방화벽 통과가 됨

HTTP 메세지에 암호화된 데이터를 담고, 일반 HTTP 채널로 데이터를 전송하는 것이다.

![2025  8  22  20:55 Microsoft Lens](https://github.com/user-attachments/assets/8773519f-e5f0-4107-a584-8808ee6cbbe6)

<br>

#### SSL 터널링 vs HTTP/HTTPS 게이트웨이
HTTPS도 다른 프로토콜과 마찬가지로 게이트웨이를 통과할 수 있다. 그럼 프락시가 응답을 받을 때, 복호화하고 HTTP를 통해서 클라이언트로 전송하게 된다.

이처럼 하려면 여러 문제가 있다.
- 클라이언트-게이트웨이는 보안이 적용안된 HTTP 커넥션 사용
- 게이트웨이가 SSL 지원
- 클라이언트가 원격 서버에 SSL 인증 불가능

따라서 이때는 SSL 터널링을 사용하여 프락시에 SSL을 구현하지 않게 하여 보안에 관여없이 암호화된 데이터를 그대로 터널링하게 한다.

<br>

#### 터널 보안에 대한 고려사항
터널 게이트웨이는 통신하고 있는 프로토콜이 터널을 올바른 용도로 사용하는지 검증할 수 없다.

따라서 터널 오용을 최소화하기 위해 게이트웨이는 HTTPS 포트인 443만을 터널링할 수 있게 허용해야 한다.

##

### 릴레이
HTTP 릴레이는 HTTP 명세를 완전히 준수하지 않는 간단한 HTTP 프락시이다. 릴레이는 커넥션을 맺기 위해 HTTP 통신을 한 다음, 모든 헤더와 메소드 로직을 수행하지 않고 맹목적으로 트래픽을 전달하는 간단한 프락시이다.

단순 맹목적 릴레이를 구현하는데 관련된 문제는 Connection 헤더를 제대로 처리하지 못해 Keep-alive 커넥션이 행에 걸리는 것이다.

![2025  8  22  21:03 Microsoft Lens](https://github.com/user-attachments/assets/f79cd70d-4587-47de-a6ac-2ba2185cef91)

서버는 keep-alive를 받았으니 커넥션을 안 닫는데, 릴레이는 새 요청을 무시하고 닫히기를 기다리니까 행이 생기는 거임

이런 위험 예방을 위해 릴레이를 똑똑하게 할 수 있지만, 프락시의 단순함에서 벗어날 수 있다.

프락시는 HTTP를 제대로 준수하는게 좋으니까 알잘딱 고민 ㄱㄱ
