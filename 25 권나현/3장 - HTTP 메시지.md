# 3장 HTTP 메시지

> HTTP가 인터넷의 배달원이라면 HTTP 메시지는 소포
<br>

## 3.1 메시지의 흐름
HTTP 메시지: HTTP 애플리케이션 간에 주고받은 데이터의 블록들  
텍스트 메타 정보(메시지 설명), 데이터  
이 메시지는 클라이언트, 서버, 프락시 사이를 흐름.  
메시지 방향 용어: 인바운드, 아웃바운드, 업스트림, 다운스트림  
<br>
> 3.1.1 메시지 송신: 원 서버 방향을 인바운드로

인바운드로 이동:  메시지가 원 서버로 향하는 것  
아웃바운드로 이동: 모든 처리가 끝난 뒤 메시지가 사용자 에이전트로 돌아오는 것

> 3.1.2 다운스트림으로 흐르는 메시지

HTTP 메시지는 강물과 같이 흐른다.  
요청/응답 관계없이 모든 메시지는 다운스트림으로 흐른다는 뜻.  
수신자의 업스트림: 메시지의 발송자

## 3.2 메시지의 각 부분
HTTP 메시지: 단순한, 데이터의 구조화된 블록  
각 메시지는 클라이언트로부터의 요청이나 서버로부터의 응답 중 하나를 포함  
메시지의 구성: 시작줄, 헤더 블록, 본문  
1. 시작줄: 어떤 메시지인지 서술  
2. 헤더 블록: 속성(Content-Type 줄: 본문 내용, Content-Length 줄: 본문 크기)  
3. 본문(없을 수도 있음): 데이터

시작줄과 헤더는 줄 단위로 분리된 아스키 문자열  
각 줄은 캐리지 리턴(ASCII 13)과 개행 문자(ASCII 10)로 구성된 두 글자의 줄바꿈 문자열(CRLF)로 끝남.  
본문(엔터티 본문/메시지 본문): 단순히 선택적인 데이터 덩어리. 시작줄이나 헤더와는 달리 텍스트나 이진 데이터를 포함할 수도 있고 비어있을 수도 있음.  

> 3.2.1 메시지 문법

모든 HTTP 메시지는 요청 메시지나 응답 메시지로 분류된다.  
요청 메시지: 웹 서버에 특정 동작 요구  
응답 메시지: 요청의 결과를 클라이언트에게 돌려줌  

요청 메시지의 형식  
> <메서드> <요청 URL> <버전>  
> <헤더>  
>  
> <엔터티 본문>

응답 메시지의 형식
> <버전> <상태 코드> <사유 구절>  
> <헤더>  
>  
> <엔터티 본문>  

| 제목 | 내용 |
|---|---|
| 메서드 | 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작. 'GET', 'HEAD', 'POST'와 같이 한 단어로 이루어짐 |  
| 요청 URL | 요청 대상이 되는 리소스를 지칭하는 완전한 URL 혹은 URL의 경로 구성요소 |
| 버전 | 이 메시지에서 사용 중인 HTTP의 버전. 형식: HTTP/<메이저(정수)>.<마이너(정수)> |
| 상태 코드 | 요청 중에 무엇이 일어났는지 설명하는 세 자리의 숫자 (첫 번째 자리수: 상태의 일반적 분류 '성공', '에러' |
| 사유 구절 | 숫자로 된 상태 코드의 의미를 사람이 이해할 수 있게 설명하는 짧은 문구, 상태 코드 이후부터 줄바꿈 문자열까지 |
| 헤더들 | 이름, 콜론(:), 선택적인 공백 값, CRLF가 순서대로 나타나는 0개 이상의 헤더들. 이 헤더의 목록은 빈 줄(CRLF)로 끝나 헤더 목록의 끝과 엔터티 본문의 시작을 표시 |
| 엔터티 본문 | 임의의 데이터 블록을 포함. 모든 메시지가 갖는 것은 아님 |  

주의: 헤더나 엔터티 본문이 없더라도 HTTP 헤더의 집합은 항상 빈 줄(CRLF)로 끝나야 함  

> 3.2.2 시작줄

모든 HTTP 메시지는 시작줄로 시작한다. (요청 메시지에서: 무엇을 해야 하는지, 응답 메시지에서: 무슨 일이 일어났는지)  

**요청줄**: 동작 설명 메서드, 그 동작의 대상을 지칭하는 요청 URL, 클라이언트의 HTTP 버전이 포함됨. 모든 필드는 공백으로 구분.  
**응답줄**: 응답 메시지에서 쓰인 HTTP 버전, 상태 코드(숫자), 수행 상태 사유 구절(텍스트) 이 포함됨. 모든 필드는 공백으로 구분.  
**메서드**: 요청의 시작줄을 시작하며 서버에게 요청사항을 전달  

많이 쓰이는 HTTP 메서드    

| 메서드 | 설명 | 메시지 본문이 있는가? |
|---|---|---|
| GET | 서버에서 어떤 문서를 가져온다. | X |
| HEAD | 서버에서 어떤 문서에 대해 헤더만 가져온다. | X |
| POST | 서버가 처리해야 할 데이터를 보낸다. | O |
| PUT | 서버에 요청 메시지의 본문을 저장한다. | O |
| TRACE | 메시지가 프락시를 거쳐 서버에 도달하는 과정을 추적한다. | X |
| OPTIONS | 서버가 어떤 메서드를 수행할 수 있는지 확인한다. | X |
| DELETE | 서버에서 문서를 제거한다. | X |  

**상태 코드**: 클라이언트에게 무엇이 일어났는지 전달하며 응답에 시작줄에 위치. 숫자 코드와 문자열 메시지 두 형태 모두로 반환.  
세 자리 숫자로 된 그들의 코드값을 기준으로 묶임.  

상태 코드의 종류  

| 전체 범위 | 정의된 범위 | 분류 |
|---|---|---|
| 100-199 | 100-101 | 정보 |
| 200-299 | 200-206 | 성공 |
| 300-399 | 300-305 | 리다이렉션 |
| 400-499 | 400-415 | 클라이언트 에러 |
| 500-599 | 500-505 | 서버 에러 |  

**사유 구절**: 응답 시작줄의 마지막 구성요소. 상태 코드에 대한 글로 된 설명을 제공. 상태 코드와 일대일로 대응됨(상태 코드의 사람 이해 버전)  
**버전 번호**: HTTP/x.y 형식으로 요청, 응답 메시지 양쪽 모두에 기술됨.  

> 3.2.3 헤더
HTTP 헤더 필드는 요청과 응답 메시지에 추가 정보를 더한다. 기본적으로 이름/값 쌍의 목록이다.
ex) Content-length: 19 (Content-length 헤더 필드에 19라는 값을 할당)

HTTP 헤더 분류  

| 제목 | 내용 |
|---|---|
| 일반 헤더 | 요청과 응답 양쪽에 모두 나타날 수 있음 |
| 요청 헤더 | 요청에 대한 부가 정보 제공 |
| 응답 헤더 | 응답에 대한 부가 정보 제공 |
| Entity 헤더 | 본문 크기와 콘텐츠, 혹은 리소스 그 자체 서술 |
| 확장 헤더 | 명세에 정의되지 않은 새로운 헤더 |  

각 HTTP 헤더의 문법 - 이름, 쉼표, 공백(없어도 됨), 필드 값, CRLF 순서  
헤더를 여러 줄로 나누기: 추가 줄 앞에는 최소 하나의 스페이스 혹은 탭 문자가 옴  

> 3.2.4 엔터티 본문
HTTP 메시지의 화물, HTTP가 수송되도록 설계된 것 (여러 종류의 디지털 데이터)

> 3.2.5 버전 0.9 메시지
HTTP 프로토콜의 초기 버전  

## 3.3 메서드  
모든 서버가 모든 메서드를 구현하지는 않는다. 그래도 메서드는 대부분 제한적으로 사용된다.  
이 제한은 일반적으로 서버 설정에 의해 정해진다.(사이트, 서버마다 다를 수 있음)  

> 3.3.1 안전한 메서드

안전한 메서드 == 메서드를 사용하는 HTTP 요청의 결과로 서버에 어떤 작용도 없음  

> 3.3.2 GET

가장 흔히 쓰이는 메서드로, 주로 서버에게 리소스를 달라고 요청하기 위해 쓰인다.  

> 3.3.3 HEAD

정확히 GET처럼 행동하지만, 서버는 응답으로 헤더만을 돌려준다. 엔터티 본문을 반환되지 않음.  
-> 클라이언트가 리소스를 실제로 가져올 필요 없이 헤더만을 조사할 수 있도록 함  
- HEAD 사용의 효과  
  리소스를 가져오지 않고도 그에 대해 무엇인가(타입 등)를 알아낼 수 있음
  응답의 상태 코드를 통해 개체가 존재하는지 확인 가능
  헤더를 확인하여 리소스의 변경유무 검사
  
> 3.3.4 PUT

GET(서버로부터 문서 읽어들임)와 반대로 서버에 문서를 쓴다.  
PUT 메서드의 의미: 서버가 요청의 본문을 가지고 요청 URL의 이름대로 새 문서를 만들거나, 이미 URL이 존재한다면 본문을 사용해서 교체하는 것.
콘텐츠를 변경할 수 있게 하기 때문에 많은 웹 서버가 이것을 수행하기 전에 비밀번호 로그인을 요구함.  

> 3.3.5 POST

서버에 입력 데이터를 전송하기 위해 설계됨. (HTML폼 지원 위해 흔히 사용)  
채워진 폼에 담긴 데이터 -> 서버로 전송 -> 서버가 모아서 필요 장소(데이터 처리 게이트웨이)에 전송  

> 3.3.6 TRACE

클라이언트에게 자신의 요청이 서버에 도달했을 때 어떻게 보이게 되는지 알려줌  
주로 진단 위해 사용  

> 3.3.7 OPTIONS

웹 서버에게 여러 가지 종류의 지원 범위에 대해 물어봄. (특정 리소스에 어떤 메서드가 지원되는지 등)  
여러 리소스에 대해 실제로 접근하지 않고도 어떤 접근이 최선일지 확인할 수 있는 수단을 클라이언트에게 제공  

> 3.3.8 DELETE

서버에게 요청 URL로 지정한 리소스를 삭제할 것을 요청  

> 3.3.9 확장 메서드

HTTP/1.1 명세에 정의되지 않은 메서드.
EX) LOCK(잠금), MKCOL(문서생성), COPY(복사), MOVE(옮김)  

## 3.4 상태 코드  

> 3.4.1 100-199: 정보성 상태 코드

100 Continue: 요청의 시작 부분 일부가 받아들여졌으며 클라이언트는 나머지를 계속 이어서 보내야 함. 이후 서버는 반드시 요청 받아 응답해야 함.  
101 Switching Protocols: 클라이언트가 Upgrade 헤더에 나열한 것 중 하나로 서버가 프로토콜을 바꾸었음  

> 3.4.2 200-299: 성공 상태 코드

200 OK: 요청은 정상이고, 엔터티 본문은 요청된 리소스를 포함하고 있다.  
201 Created: 서버 개체를 생성하라는 요청을 위한 것. 응답은 Location 헤더와 함께 여러 참조 URL을 엔터티 본문에 포함해야 함.  
202 Accepted: 요청은 받아들여졌으나 서버는 아직 그에 대한 어떤 동작도 수행하지 않음. 요청 처리 완료에 대한 보장 없음  
203 Non-Authoritative Information: 엔터티 헤더에 들어있는 정보가 원래 서버가 아닌 리소스의 사본에서 왔다.  
204 No Content: 응답 메시지는 헤더와 상태줄 포함하지만 엔터티 본문은 포함하지 않음(웹브라우저를 이동시키지 않고 갱신할 때)  
205 Reset Content: 브라우저에게 현재 페이지에 있는 HTML 폼에 채워진 모든 값을 비우라고 말함  
206 Partial Content: 부분 혹은 범위 요청이 성공함  

> 3.4.3 300-399: 리다이렉션 상태 코드  

300 Multiple Choices: 요청에 대해 여러 응답이 가능하며, 클라이언트가 선택해야 함.  
301 Moved Permanently: 요청한 리소스가 영구적으로 다른 URI로 이동됨.  
302 Found: 요청한 리소스가 일시적으로 다른 URI에 있음.  
303 See Other: 다른 URI에서 리소스를 GET 요청으로 확인하라는 의미.  
304 Not Modified: 리소스가 수정되지 않아 캐시된 버전을 사용해도 됨.  
305 Use Proxy: 요청한 리소스는 반드시 프록시를 통해 접근해야 함. (현재는 는 크게 다섯 가지로 분류됨: 일반 헤더, 요청 헤더, 응답 헤더, 엔터티 헤더, 확장 헤더  

> 3.5.1 일반 헤더

메시지에 대한 아주 기본적인 정보 제공  
**일반 정보 헤더**: Connection, Date, MIME-Version 등  
**일반 캐시 헤더**: 원 서버로부터 객체 가져오는 대신 로컬 복사본으로 캐시할 수 있는 헤더  

> 3.5.2 요청 헤더

요청 메시지에서만 의미를 갖는 헤더  
요청이 최초 발생한 곳에서 누가/무엇이 그 요청을 보냈는지에 대한 정보, 클라이언트의 선호나 능력에 대한 정보 제공  
**요청 정보 헤더**: Client-IP, From, Host, Referer 등
**Accept 관련 헤더**: 서버에게 자신의 선호와 능력을 알려줌  
**조건부 요청 헤더**: 서버에게 요청에 응답하기 전에 조건이 참인지 확인하는 제약 포함시킴  
**요청 보안 헤더**: 요청을 위한 인증요구/응답  
**프락시 요청 헤더**: 프락시의 기능을 돕는 헤더  

> 3.5.3 응답 헤더

클라이언트에게 부가 정보 제공  
누가 응답을 보내고 있는지, 응답자의 능력은 어떻게 되는지, 응답에 대한 특별한 설명 제공  
**응답 정보 헤더**: Authorization, Cookie, Cookie2
**협상 헤더**: 여러 가지 표현이 가능한 상황일 때 서버와 클라이언트가 어떤 표현을 택할 것인지 협상  
**응답 보안 헤더**: 인증요구/응답 체계에서 응답에 해당  

> 3.5.4 엔터티 헤더

엔터티와 그것의 내용물에 대한 광범위한 정보 제공(개체 타입, 유효한 메서드 등)  
**엔터티 정보 헤더** : Allow, Location  
**콘텐츠 헤더**: 엔터티의 콘텐츠에 대한 구체적 정보 제공(종류, 크기 등)  
**엔터티 캐싱 헤더**: 엔터티 캐싱에 대한 정보 제공(엔터티가 언제 어떻게 캐시되어야 하는지)  
